<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banner Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        .image-preview {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .preview-container {
            position: relative;
        }
        .preview-container img {
            width: 100px;
            height: auto;
            border-radius: 5px;
        }
        .remove-icon {
            position: absolute;
            top: -5px;
            right: -5px;
            background: red;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-light">

    <div class="container mt-4">
        <h2 class="text-center mb-4">Banner Management</h2>

        <div class="card shadow p-4 mb-4">
            <h4 class="mb-3">Upload New Banner</h4>
            <form action="/admin/banner/upload" method="POST" enctype="multipart/form-data">
                <div class="mb-3">
                    <label for="title" class="form-label">Banner Title:</label>
                    <input type="text" class="form-control" name="title" required>
                </div>
                <div class="mb-3">
                    <label for="description" class="form-label">Description:</label>
                    <input type="text" class="form-control" name="description" required>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Upload Banner Images (Up to 4)</label>
                    <input type="file" class="form-control" id="imageInput" accept="image/*" multiple required>
                </div>
                
                <div id="cropContainer" style="display: none;">
                    <h5>Crop Image</h5>
                    <img id="cropImage" class="img-fluid">
                    <button type="button" id="saveCropped" class="btn btn-success mt-2">Save Cropped Image</button>
                </div>
                
                <div class="image-preview mt-3" id="imagePreview"></div>

                <button type="submit" class="btn btn-primary w-100 mt-3">Upload Banner</button>
            </form>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    <script>
        let cropper;
        let selectedFile;
        let imageCount = 0;
        const imageInput = document.getElementById("imageInput");
        const cropImage = document.getElementById("cropImage");
        const cropContainer = document.getElementById("cropContainer");
        const saveCropped = document.getElementById("saveCropped");
        const imagePreview = document.getElementById("imagePreview");
        
        imageInput.addEventListener("change", function(event) {
            const files = event.target.files;
            if (files.length + imageCount > 4) {
                Swal.fire("Error", "You can upload up to 4 images only.", "error");
                return;
            }
            
            selectedFile = files[0];
            if (!selectedFile) return;
            
            cropImage.src = URL.createObjectURL(selectedFile);
            cropContainer.style.display = "block";
            
            if (cropper) {
                cropper.destroy();
            }
            
            cropper = new Cropper(cropImage, {
                aspectRatio: 16 / 9,
                viewMode: 2,
                autoCropArea: 1,
                zoomable: true,
                cropBoxResizable: true,
                dragMode: "move",
            });
        });
        
        saveCropped.addEventListener("click", async function() {
            if (!cropper) return;
            
            const croppedCanvas = cropper.getCroppedCanvas({
                width: 800,
                height: 450,
                imageSmoothingQuality: "high"
            });
            
            if (!croppedCanvas) {
                Swal.fire("Error", "Cropping failed. Try again.", "error");
                return;
            }
            
            const blob = await new Promise(resolve => croppedCanvas.toBlob(resolve, "image/jpeg", 0.8));
            const croppedFile = new File([blob], `cropped_${Date.now()}.jpg`, { type: "image/jpeg" });
            
            const dataTransfer = new DataTransfer();
            for (let file of imageInput.files) {
                dataTransfer.items.add(file);
            }
            dataTransfer.items.add(croppedFile);
            imageInput.files = dataTransfer.files;
            
            imageCount++;
            
            const previewContainer = document.createElement("div");
            previewContainer.classList.add("preview-container");
            
            const previewImg = document.createElement("img");
            previewImg.src = croppedCanvas.toDataURL("image/jpeg");
            previewContainer.appendChild(previewImg);
            
            const removeIcon = document.createElement("span");
            removeIcon.classList.add("remove-icon");
            removeIcon.innerHTML = "&times;";
            removeIcon.onclick = function() {
                previewContainer.remove();
                imageCount--;
            };
            previewContainer.appendChild(removeIcon);
            
            imagePreview.appendChild(previewContainer);
            
            cropContainer.style.display = "none";
            cropper.destroy();
            
            Swal.fire("Success", "Image cropped and added!", "success");
        });
    </script>
</body>
</html>
